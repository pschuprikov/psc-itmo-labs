\section{Построение береговых координат}

Для реализации всех эффектов используется единая система координат $(x_c, y_c)$, 
определенная в окрестности берега. Причем $x_c$ непрерывным образом изменяется вдоль берега,
а $y_c$ координата является аналогом расстояния до берега и изменяется, соответственно, по направлению к 
берегу. Реализация данной системы координат осуществляется с помощью предварительной обработки контура 
береговой линии, смещения его по направлению внутрь и во вне берега и последующей генерации геометрии по
полученным данным.

\subsection{Straight skeleton}
Для смещения береговой линии выбрана структура данных, известная как \emph{Straight Skeleton}, 
используемый алгоритм построения которой основан на работе \cite{skeleton}. Данная структура 
данных позволяет построить смещение полигона, которое представляет собой приемлемую альтернативу 
для <<честного>> смещения на заданное расстояние. Заметим, что честное смещение, в общем случае, 
уже не является полигоном, потому как для бесконечно большого смещения, результирующая кривая 
представляет собой окружность. 

Кратко опишем структуру данных \emph{Straight Skeleton}. Предположим, что у нас имеется некоторое здание, 
представляющий собой прямоугольную призму с основанием, границей которого является некоторый полигон.
Пусть далее мы решили выяснить как выглядит крыша это здания, если наклон крыши всюду один и тот же. 
Оказывается, что множество ребер получившейся крыши не зависит от величины наклона. Данное множество 
ребер и множество граней крыши и является рассматриваемой структурой данных. 

Смещение полигона на величино $\mathrm{offset} > 0$ получается следующим образом: поочередно 
проходим по всем граням \empg{Straight Skeleton}-а, в каждой грани находим точки, 
находящихся на расстоянии $\mathrm{offset}$ от основания грани (граница основания здания). Можно показать, что грани 
всегда будут выпуклыми многоугольниками, поэтому либо таких точек будет:
\begin{enumerate}
\item ни одной;
\item ровно две;
\item ровно одна (она является единственной наиболее удаленной точкой грани);
\item бесконечно много, и этот случай мы не рассматривать не будем, считая его границей
применимости данного метода. Этот случай связан со смещением, приводящим к <<схлопыванию>> 
бухт на контуре береговой линии.
\end{enumerate}

Пусть через точку $(x, y)$ проходит полигон, смещенный на $\mathrm{offset}$, тогда
координатой $y_c$ будет служить почти $\mathrm{offset}$, а координатой
$x_c$ --- почти длина вдоль смещенного полигона до заданной точки. <<Почти>> будет 
исправлено далее.

\subsection{Растеризация координат}
Для того, чтобы вычислить значение координат в любой точке трехмерной сцены используя
аппаратно ускоренную растеризацию, решено весь полигон разбивается на протяженные части, 
включающие порядка тысячи отрезков, с каждой из которых будем далее работать отдельно.

Для полилинии, являющейся подмножеством полигона береговой линии $l(0)$, анализируется
\emph{Straight Skeleton} и строится некоторое множество смещенных полилиний ${l(o_0), l_(o_1), \ldots}$,
причем множество оффсетов ${o_i}$ выбирается следующим образом: для каждой вершины скелетона 
вычисляется расстояние до всех граней, которым принадлежит данная вершина и каждое из этих расстояний
добавляется в множество ${o_i}$. Получившееся множество полилиний разбивает скелетон на трапеции, 
причем каждая параллельная грань трапеций соответствуют какому-то отрезку какого-то смещения $l(0)$.