\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{graphicx}
\usepackage{algpseudocode}
\usepackage{algorithmicx}

\author{Чуприков Павел Сегреевич}
\title{Курсовая работа по теме: "Вычисление дискретной временной диаграммы Вороного с использованием графического процессора"}
\begin{document}
\begin{titlepage}
\maketitle
\end{titlepage}

\tableofcontents

\pagebreak

\section{Введение}
\emph{Диаграммы Вороного} --- широко известный и глубоко изученный предмет вычислительной геометрии. Его можно кратко описать как такой способ разбиения плоскости, где сначала выделяется некоторое множество точек-источников, и затем каждая точка плоскости "красится" в цвет ближайшей к ней точки-источника. Таким диаграммам находится множество применений в таких задачах, как определение столкновений, планирование пути, кластеризация данных, обзор применений 
можно найти в \cite{survey}. Нашли применения даже визуальные свойства такого разбиения плоскости: например, в области процедурной генерации текстур \cite{proced}. 

В некотором роде расширением диаграмм Вороного является \emph{преобразование расстояний} (поле расстояний, карта расстояний). Они отличаются тем, что последняя каждой точке ставит в соответствие не только цвет точки-источника, но и расстояние до нее (на самом деле в некоторых применениях важно только лишь расстояние). Область применимости поля расстояний включает: определение столкновений, навигацию искусственного интеллекта, отрисовка векторных данных. 

И первая и вторая геометрическая конструкции легко обобщаются на случай, когда в качестве источников выступают не точки, а отрезки, окружности или любые другие геометрические примитивы. 

Нужно отметить, что и диаграмма Вороного и поле расстояний --- это математические объекты, для практического их применения в программных продуктов, можно выделить два принципиально различных методов хранения этих объектов (или их приближений) --- это \emph{векторный} и \emph{дискретный}. Лучшая аналогия будет с векторным и растровым способами представления изображений в памяти компьютера соответственно. В первом случае поддерживается некоторая структура данных, например \emph{двусвязный список ребер} (англ. Double Connected Edge List --- DCEL), во втором случае --- область, для которой строится диаграмма Вороного, дискретизируется и для каждой единицы дискретизации цвет или расстояние хранятся отдельно.

Несмотря на то, что существует множество алгоритмов разной степени эффективности для построения как диаграмм Вороного, так и поля расстояний, в них обычно используется стандартная Евклидова метрика. Однако, часто одного расстояния недостаточно, может потребоваться фактическое время, которое необходимо затратить для перемещения из точки-источника в какую-либо точку плоскости. Заметим, что стандартная диаграмма Вороного с Евклидовой метрикой, в случае неоднородности области, не подходит.
Существует статья (\cite{timeb}), в которой описывается нахождение временной диаграммы вороного в присутствии двух бесконечных прямых, скорость перемещении вдоль которых не совпадает со скоростью в остальной части плоскости. Простейший пример неоднородности можно найти при планировании маршрута: наличие дорог, скорость вдоль которых обыкновенно значительно выше, чем вне них. В данной работе описывается метод, который при некоторых (весьма строгих) упрощениях позволяет решить эту проблему для дискретного представления полей расстояний или диаграмм Вороного.

\section{Постановка задачи}
\label{task}
Итак, мы собираемся строить т.н. \emph{временную диаграмму Вороного} (англ. Time-based Voronoi diagramm) некоторой области, которая будет рассчитываться не по расстояние, а по времени, для этого на всей области будет определено некоторое поле скоростей. 

\paragraph{Условие задачи.} Далее, опираясь на вводную часть, перечислим основные условия и свойства задачи, которую мы будем хотим решать:
\begin{itemize}
\label{props}
\item область построения диаграммы Вороного --- прямоугольник, скорость предполагается постоянной за исключением \emph{областей неоднородности} (см. далее);
\item структура представления --- дискретная (прямоугольник будет разбит на ячейки равномерной сеткой);
\item форма источников --- отрезки или точки на плоскости, для каждого источника должно быть указано время, которое необходимо затратить, чтобы попасть в сам источник (важная информация, далее подробно);
\item области неоднородности --- это сами источники, при этом скорость вдоль каждого отрезка может быть разной по отношению к скорости вне областей неоднородности.
\item считается, что как только воображаемый маршрут покидает область неоднородности, то далее его скорость всегда совпадает со скоростью вне неоднородных участков.
\end{itemize}

\paragraph{Требуется найти.}
В итоге мы хотим получить <<раскрасску>>, а именно --- мы должны знать для каждой ячейки сетки, какой источник нужно выбрать для данной ячейки так, чтобы сумма времени до источника и времени от источника до ячейки была минимальна.

Далее подробнее об этих свойствах их следствия и способах их обхождения.

\subsection{Постоянство скорости вне неоднородностей}
\label{multi_type}
Это ограничение достаточно серьезно, так как сильно отличается от реальности: проходимость в лесу может существенно отличаться от проходимости в поле. Однако есть достаточно простой способ обойти это ограничение ценой удваивания времени работы, которое позволит построить временную диаграмму вороного при наличии различных по скорости подобластей, при условии, что подобласть меняется не более одного раза внутри маршрута. Этот способ не был реализован в рамках данной работы, его суть в следующем:

Пусть мы можем вычислить цвета вершин и времена до источника для какой-то подобласти нашей области при фиксированной скорости. Тогда алгоритм, который учтет переходы между областями можно представить так (рис.~\ref{multi_type_fig}):
\begin{enumerate}
\item для каждой подобласти вычислить диаграмму Вороного отдельно, используя скорость внутри выбранной подобласти;
\item добавить к точкам-источникам границы областей, используя посчитанное в предыдущем шаге время от источников до точек как время до новых точек-источников (смотреть форму источников в \ref{props});
\item cнова вычислить диаграммы внутри подобластей используя новые точки-источники.
\end{enumerate}
\begin{figure}
\center\includegraphics[scale=0.5]{multy_type.png}
\caption{Пример области с различными скоростями на подобластях. Коричневым выделены точки-источники используемые во втором проходе построения временных диаграмм Вороного}
\label{multi_type_fig}
\end{figure}

Таким образом мы сможем учесть информацию от соседних с данной подобластью подобластей и тем самым учесть маршруты пересекающие границы подобластей лишь один раз.

\subsection{Области неоднородности}
Пожалуй сейчас самое время сказать о том, для какого рода данных планируется использовать решение поставленной задачи. Эти данные представляют собой некоторую местность, возможно разнородную (\ref{multi_type}), на которой расположена некоторая сеть дорог, вдоль которых мы можем двигаться с какими-то более высокими скоростями. Для каждой точки местности мы хотели бы узнать за какое кратчайшее время и каким способ мы сможем добраться до заданной точки (при этом для простоты предположим, что мы находимся на дороге). При этом допускается ситуация, когда существует несколько  <<путешественников>> и мы хотим хотим узнать кто из них доберется быстрее. 

Предположим также, что сеть дорог связна и дана нам в виде графа, а также пусть нам намного выгоднее двигаться вдоль дорог, чем по какому-то другому типу местности (что в целом недалеко от реальности). Последние ограничения нужны для того, чтобы  последний пункт в \ref{props}, не портил нам жизнь, ведь он в действительности говорит о том, что любой маршрут состоит из какой-то  части вдоль дороги и затем по местности. 

Теперь мы можем для решения поставленной в данной части задачи сделать следующее:
\begin{enumerate}
\item решить поставленную задачу для графа дорог. Так как вершин графа мало по сравнению с числом точек на плоскости, и граф дорог --- планарный, то время решение этой подзадачи мало;
\item определить, используя данные предыдущего шага, для каждого ребра ближайшего к нему <<путешественника>> и время соответствующее время;
\item отдать на вход \ref{task} данные предыдущего шага и получить результат.
\end{enumerate}

Отсюда можно понять, зачем нам нужна возможность указать время до каждого отрезка области неоднородности, и оправдание для последнего пункта~\ref{props}. Поясняющий рисунок~\ref{task_fig}.

\begin{figure}
\center\includegraphics[scale=0.6]{sample.png}
\caption{Пример временной диаграммы Вороного: имеется несколько ломаных, вдоль которых можно двигаться со скоростью вдвое превышающей скорость вне ломаных. Считается, что время до самых левых точек равно нулю.}
\label{task_fig}
\end{figure}

\section{Обзор предыдущих методов}
В этой части будет рассмотрен метод, или точнее класс методов, построения дискретных диаграмм Вороного, который допускает
параллельное исполнение во множестве потоков. Затем будет приведено обобщение метода для источников произвольной формы и, наконец, несколько простых результатов, полученные в работе \cite{timeb}, которые далее будут в нашем методе.

\subsection{Jump-Flooding Algorithm (JFA)}
Идеи рассматриваемого далее алгоритма впервые были представлены в работе Дэниелсона \cite{distmap} в 1980~г. Однако, из-за отсутствия в то время массивно-параллельных (англ. massively-parallel) архитектур, эти идеи тогда были неприменимы на практике. Спустя более чем 20 лет, Гуодонг Ронг и Тиоу-Сенг Тан \cite{jfa} на основе работы Дэниелсона разработали алгоритм построения дискретной диаграммы Вороного, который несложно реализовать на современных графических процессорах, архитектура которых допускает параллельное выполнения более миллиона потоков.

Основу алгоритма состовляет так называемый метод \textbf{JFA} (англ. Jump-Flooding Algorithm). Кратко опишем его на примере диаграммы Вороного. Пусть на вход мы получаем 
некоторую дискретизацию прямоугольной области равномерной сеткой размера $m \times n$. Каждая ячейка $\mathrm{cell}_{ij}$ содержащая точку источник, содержит некоторую информацию $\mathrm{seed}_{ij}$ о его месте нахождения, иначе некоторый идентефикатор отсутствия определенной информации ${\mathrm{null}}$:
$$
	\mathrm{cell}_{ij} = \left\lbrace
	\begin{array}{ll}
	\mathrm{seed}_{ij}, & \mbox{в ячейке есть точка-источник} \\
	\mathrm{null}, & \mbox{в точке нет точки-источника}
	\end{array}
	\right.
$$

Далее информация о точках-источниках будет распространятся на остальные ячейки сетки, и в каждой ячейке будет храниться информация о ближайщем источнике, про который ячейке известно на данный момент. Распространение осуществляется в неколько итераций. Во время одной итерации каждая ячейка в отдельном потоке исполнения получет информацию об источниках от некоторых других ячеек, и выбирает ближайший источник из известных. Пусть $k = \max(\lfloor\log_2n\rfloor, \lfloor\log_2m\rfloor)$, тогда выполним $k$ операций, при этом $i$-ую для ячейки сетки $\mathrm{cell}_{rc}$ можно описать следующим образом:

\begin{algorithmic}
\label{jfa_algo}
\State $\mathrm{mindist} \leftarrow \infty$
\State $\mathrm{step} \gets 2^{k - i}$
\State $p \gets r - \mathrm{step}$
\While{ $p \le r + \mathrm{step}$}
	\State $q \gets c - \mathrm{step}$
	\While{$q \le c + \mathrm{step}$}
		\If {$\mathrm{cell}_{pq} \neq \mathrm{null}$}
			\State $\mathrm{mindist} \gets 
 					\min(\mathrm{distanceTo}(\mathrm{cell}_{pq}), \mathrm{mindist})$
		\EndIf
		\State $q \gets q + \mathrm{step}$
 	\EndWhile
\State $p \gets p + \mathrm{step}$
\EndWhile
\end{algorithmic}

Всего итераций выполняется $k$, однако для уменьшения количества ошибок в статье предлагается выполнять еще одну итерацию с $\mathrm{step}~=~1$. Эксперименты подтверждают уменьшение числа ощибок, при том, что дальнейшее уменьшение числа ощибок с последующими итерациями незначительно. Модификацию \textbf{JFA} с дополнительной итерацией обозначают как \textbf{JFA+1}.

\paragraph{Реализация.} Метод был реализован с использованием графического процессора. Информация о ячейке хранилась в двумерной текстуре. На каждой итерации запускалась отрисовка полноэкранного прямоугольника во внеэкранный фреймбуффер, при этом каждой выходной ячейке соответствует выходной фрагмент и \ref{jfa_algo} выполнялся во фрагментном шейдере.

\subsection{Обобщенные диаграммы Вороного}


\section{Предлагаемый метод}
\section{Реализация}
\section{Результаты}
\section{Дальнейшие исследования}

\pagebreak

\begin{thebibliography}{10}
\bibitem{survey} Franz Aurenhammer. \textit{Voronoi Diagramm --- A Survey of a Fundamental Geomteric Data Structure}.
\bibitem{proced} David S. Elbert et al. \textit{Texturing and Modelling, Third Edition: A Procedural Approach}.
\bibitem{timeb} D. T. Lee, C. S. Liao, W. B. Wang. \textit{Time-Based Voronoi Diagram}.
\bibitem{distmap} Danielsson P. E. \textit{Euclidian Distance Mapping}. Computer Graphics and Image Processing 14, 227-248.
\bibitem{jfa} Guodong Rong, Tiow-Seng Tan. \textit{Jump Flooding in GPU with Applications to Voronoi Diagram and Distance Transform}. School of Computing, National University of Singapore, National University of Singapore. 
\end{thebibliography}

\end{document}